@page "/impostergame"
<PageTitle>Imposter</PageTitle>
@using ImposterGame.Models
@using ImposterGame.Services
@inject NavigationManager NavigationManager



<RadzenText TextStyle="TextStyle.DisplayH3"
            Style="font-family: 'Far_Morvarid';
            font-size: 1.8rem;
            font-weight: 600;
            color: #222;
            text-align: center;">
    بازی شیاد  <RadzenImage Path="\Icons\mask.png" Style="width: 4rem;" />
</RadzenText>
@if (!gameStarted)
{
    <RadzenText TextStyle="TextStyle.DisplayH4"
                Style="font-family: 'Far_Morvarid';
                                    font-size: 2rem;
                                    font-weight: 600;
                                    color: #123;
                                    text-align: center;">نام بازی کن ها را وارد کنید</RadzenText>

    <RadzenCard Style="width:90%; max-width:400px; margin:auto; text-align:center;">
        @foreach (var item in Players)
        {
            @if (!string.IsNullOrEmpty(item.Name))
            {
                <RadzenRow JustifyContent="JustifyContent.Right" AlignItems="@AlignItems.Center" Gap="3">
                    <RadzenButton Click="() => RemovePlayer(item)"
                                  Variant="Variant.Text"
                                  Icon="close"
                                  Size="ButtonSize.ExtraSmall"
                                  ButtonStyle="ButtonStyle.Danger"
                                  Style="" />
                    <div class="rz-p-3">
                        <RadzenText TextStyle="TextStyle.DisplayH5"
                                    Style="font-family: 'Far_Morvarid';
                                                                                                font-size: 1.8rem;
                                                                                                font-weight: 300;
                                                                                                color: #222;
                                                                                                text-align: center;">@item.Name</RadzenText>

                    </div>
                    <RadzenImage Path="@item.Uri" Style="width: 2rem;"></RadzenImage>
                </RadzenRow>
            }
            else
            { }
        }

        @*add name and select avatar *@
        <RadzenTextBox Style="width:100%; margin-bottom:10px;" @bind-Value="newPlayer.Name" Placeholder="نام" />
        <SelectAvatar OnAvatarSelected="@HandleAvatarSelected"></SelectAvatar>

    </RadzenCard>


    <RadzenButton Text="اضافه کردن بازی کن" Click="@AddPlayer" Style="width:100%; margin-top:10px;" />

    @if (Players.Count >= 3)
    {

        <RadzenButton Text="شروع بازی" click="@AssignRoles" Style="width:100%; margin-top:10px;" />
    }
}
else
{
    <RadzenCard Style="width:90%; max-width:420px; margin:auto; text-align:center; border-radius:20px; box-shadow:0 4px 12px rgba(0,0,0,0.1); padding:20px; background:#fff;">
        <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Center" Gap="15px">
            <RadzenImage Path="@currentPlayer.Uri"
                         Style="width:8rem; height:8rem; border-radius:50%; object-fit:cover; box-shadow:0 0 6px rgba(0,0,0,0.15);" />

            <RadzenText Text="@currentPlayer.Name"
                        Style="font-family:'Far_Morvarid'; font-size:1.6rem; font-weight:700; color:#222;" />

            @if (!currentPlayer.HasViewedCard)
            {
                <RadzenButton Text="👀 دیدن کارت"
                              Size="ButtonSize.Large"
                              Click="@ShowCard"
                              ButtonStyle="ButtonStyle.Warning"
                              Style="width:100%; max-width:300px; border-radius:12px; font-weight:600; font-size:1.1rem;" />
            }
            else
            {
                <RadzenPanel Style="width:100%; max-width:320px; background:#ffdd59; border-radius:15px; box-shadow:inset 0 0 5px rgba(0,0,0,0.1); padding:20px;">
                    <RadzenText Text="@CardText"
                                TextStyle="TextStyle.DisplayH4"
                                Style="font-family:'Far_Morvarid'; font-size:1.8rem; font-weight:600; color:#222; text-align:center;" />
                </RadzenPanel>

                @if (currentIndex >= gameService.Players.Count - 1)
                {
                    <RadzenButton Text="🎮 شروع بازی"
                                  Size="ButtonSize.Large"
                                  Click="@StartGame"
                                  ButtonStyle="ButtonStyle.Success"
                                  Style="width:100%; max-width:300px; border-radius:12px; font-weight:600; font-size:1.1rem;" />
                }
                else
                {
                    <RadzenButton Text="➡️ نفر بعدی"
                                  Size="ButtonSize.Large"
                                  Click="@NextPlayer"
                                  ButtonStyle="ButtonStyle.Info"
                                  Style="width:100%; max-width:300px; border-radius:12px; font-weight:600; font-size:1.1rem;" />
                }
            }
        </RadzenStack>
    </RadzenCard>
}
